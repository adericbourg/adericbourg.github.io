<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Blog bloquant</title><link href="http://www.dericbourg.net/" rel="alternate"></link><link href="http://www.dericbourg.net/feeds/all.atom.xml" rel="self"></link><id>http://www.dericbourg.net/</id><updated>2015-08-11T00:00:00+02:00</updated><entry><title>Problème des huit reines</title><link href="http://www.dericbourg.net/2015/08/11/probleme-des-huit-reines/" rel="alternate"></link><updated>2015-08-11T00:00:00+02:00</updated><author><name>Alban Dericbourg</name></author><id>tag:www.dericbourg.net,2015-08-11:2015/08/11/probleme-des-huit-reines/</id><summary type="html">&lt;p&gt;J'ai rencontré le &lt;a href="https://fr.wikipedia.org/wiki/Probl%C3%A8me_des_huit_dames"&gt;problème des huits reines&lt;/a&gt; lors d'un entretien d'embauche. Sans juger de la pertinence de cet exercice dans ce cadre (indépendamment du fait que j'aie lamentablement et honteusement échoué), la période estivale, propice à la détente, m'a incité à pousser le jeu plus en avant (mon orgueil a probablement contribué lui aussi).
Le problème consiste à compter et identifier les différentes façons de placer sur un échiquier de 64 cases 8 reines de façon à ce que, relativement aux règles des échecs, elles ne se menacent pas mutuellement. Une reine peut se déplacer de façon rectiligne d'un nombre de cases arbitraire dans toutes les directions ; lorsqu'une reine est placée, la ligne, la colonne et les diagonales sur lesquelles elle se situe sont donc « condamnées ».&lt;/p&gt;
&lt;h3&gt;Modélisation&lt;/h3&gt;
&lt;p&gt;On ne peut pas placer plusieurs reines sur une même ligne. On peut donc simplifier la modélisation en ne travaillant que sur les colonnes. Ainsi, on cherchera à ne retourner qu'un tableau d'index de colonne, chacun de ces index correspondant à la ligne de son propre index dans le tableau. Pour illustrer, on produira en retour un tableau de la forme &lt;code&gt;[x, y, z]&lt;/code&gt; qui correspond en pratique aux coordonnées &lt;code&gt;(0, x)&lt;/code&gt;, &lt;code&gt;(1, y)&lt;/code&gt; et &lt;code&gt;(2, z)&lt;/code&gt; sur l'échiquier.&lt;/p&gt;
&lt;p&gt;Représentons cette modélisation dans le cas de la résolution du problème avec huit reines.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Représentation de la modélisation" class="center" src="/images/eight_queens/modelisation.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note :&lt;/strong&gt; en Python, la fonction &lt;a href="https://docs.python.org/2/library/functions.html#enumerate"&gt;&lt;code&gt;enumerate&lt;/code&gt;&lt;/a&gt; permet d'obtenir de façon immédiate ce résultat.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&amp;gt;&amp;gt;&amp;gt; list(enumerate([3, 2, 1]))
[(0, 3), (1, 2), (2, 1)]
&lt;/pre&gt;&lt;/div&gt;


&lt;/blockquote&gt;
&lt;p&gt;Il est alors « facile » de déterminer si une reine est en sécurité connaissant la position des autres :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Par construction, aucune reine ne peut être sur la même ligne.&lt;/li&gt;
&lt;li&gt;Deux reines sont sur la même colonne lorsque leur index de colonne est la même (&lt;code&gt;c[i] == c[j]&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;Deux reines sont sur la même diagonale lorsque leur différence d'index dans le tableau (donc leur différence d'index de ligne) est égal à leur différence d'index de colonne (&lt;code&gt;abs(c[i] - c[j]) == abs(i - j)&lt;/code&gt;). La valeur absolue permet de traiter indifféremment les diagonales « montantes » et les diagonales « descendantes ».&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ainsi, les solutions, lorsqu'elles existent, forment un sous-ensemble des permutations de {1 ; 2 ; ... ; &lt;em&gt;n&lt;/em&gt; - 1} (où &lt;em&gt;n&lt;/em&gt; est le nombre de reines et la dimension de l'échiquier).&lt;/p&gt;
&lt;p&gt;&lt;img alt="Représentation de la modélisation" class="center" src="/images/eight_queens/diagonale.png" /&gt;&lt;/p&gt;
&lt;h3&gt;Approche naïve : examen de l'intégralité des permutations&lt;/h3&gt;
&lt;p&gt;Cette approche revient à essayer toutes les combinaisons de placement des reines et de retenir celles pour lesquelles toutes les reines sont en sécurité. Compte tenu du fait que deux reines ne peuvent être sur la même colonne, la solution est une permutation de la suite d'entiers de 0 à &lt;em&gt;n&lt;/em&gt; - 1.&lt;/p&gt;
&lt;h4&gt;Génération des permutations&lt;/h4&gt;
&lt;p&gt;Il est possible de déterminer toutes les permutations possibles d'un tableau en utilisant — par exemple — l'&lt;a href="https://en.wikipedia.org/wiki/Heap%27s_algorithm"&gt;algorithme de Heap&lt;/a&gt; qui minimise le nombre de mouvements nécessaires à l'obtention de l'intégralité des permutations. Une permutation est obtenue de la précédente en interchangeant la position de deux éléments (et seulement deux).&lt;/p&gt;
&lt;p&gt;J'en propose une implémentation récursive : compte tenu des dimensions des tableaux de notre problème, cela reste raisonnable ; on ne risque pas le dépassement de la capacité de la pile d'exécution.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;permutations&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__permutations&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt;  &lt;span class="n"&gt;__permutations&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                    &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
                &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;__permutations&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Pour donner un exemple :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;perm&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;permutations&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt; &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;perm&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;En pratique, la bibliothèque standard Python propose dans le module &lt;a href="https://docs.python.org/3/library/itertools.html"&gt;&lt;code&gt;itertools&lt;/code&gt;&lt;/a&gt; une fonction générant ces permutations. Mesurons grossièrement le temps d'exécution de ce code avec les deux implémentations :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10000&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;perm&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;permutations&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;perm&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;# Heap
$ time python heaps.py
real    0m42.860s
user    0m42.832s
sys     0m0.008s

# itertools
$ time python itertools.py
real    0m3.433s
user    0m3.428s
sys     0m0.000s
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;La fonction de la blbliothèque standard est bien plus performante que l'implémentation proposée ci-dessus (et heureusement). On utilisera donc celle-ci pour la résolution du problème : autant ne pas tendre le bâton pour se faire battre.&lt;/p&gt;
&lt;h4&gt;Résolution&lt;/h4&gt;
&lt;p&gt;On a vu que l'ensemble des solutions était contenu dans l'ensemble des permutations de {1 ; 2 ; ... ; &lt;em&gt;n&lt;/em&gt; - 1}, soit l'ensemble des permutations de &lt;em&gt;n&lt;/em&gt; entiers distincts. De par cette modélisation :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;puisqu'on ne peut pas mettre deux valeurs au même index d'un tableau, les reines ne peuvent pas être sur la même ligne ;&lt;/li&gt;
&lt;li&gt;par construction de l'ensemble sur lequel on initialise les permutations, aucune reine ne peut être sur la même colonne qu'un autre.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Il reste alors à appliquer directement la formule de vérification des diagonales proposée dans le paragraphe &lt;em&gt;Modélisation&lt;/em&gt;. Le code qui suit n'est volontairement pas l'écriture « idéale » en Python par souci de lisibilité pour ceux qui n'y sont pas familiers.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;is_safe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;permutation&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;permutation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;permutation&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;permutation&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;On initialise la première permutation à &lt;code&gt;[0, 1, 2, ..., n - 1]&lt;/code&gt; avec &lt;code&gt;range(n)&lt;/code&gt;. Une fois les permutations calculées, le câblage de l'ensemble est immédiat.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;solve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;board_size&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;itertools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;permutations&lt;/span&gt;
    &lt;span class="n"&gt;solutions&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;permutation&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;permutations&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;board_size&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;is_safe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;permutation&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;solutions&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;permutation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;solutions&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Représentation des solutions&lt;/h4&gt;
&lt;p&gt;Il est toujours plus simple de vérifier les solutions en les visualisant. &lt;a href="https://en.wikipedia.org/wiki/Eight_queens_puzzle#Counting_solutions"&gt;Le nombre de solutions en fonction du nombre de reines étant connu&lt;/a&gt;, on ajoute le nombre de solutions trouvées pour faciliter la validation de l'algorithme.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;print_solutions&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;solutions&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;board_size&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;separator&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;+---&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;board_size&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;+&amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;solution&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;solutions&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;column&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;solution&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;separator&lt;/span&gt;
            &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;|   &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;column&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;| Q |&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;   |&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;board_size&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;column&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;separator&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Found&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;solutions&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;solutions&amp;quot;&lt;/span&gt;


&lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;
&lt;span class="n"&gt;solutions&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;solve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;print_solutions&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;solutions&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;# 91 autres solutions
# [...]

+---+---+---+---+---+---+---+---+
|   |   |   |   |   |   |   | Q |
+---+---+---+---+---+---+---+---+
|   |   |   | Q |   |   |   |   |
+---+---+---+---+---+---+---+---+
| Q |   |   |   |   |   |   |   |
+---+---+---+---+---+---+---+---+
|   |   | Q |   |   |   |   |   |
+---+---+---+---+---+---+---+---+
|   |   |   |   |   | Q |   |   |
+---+---+---+---+---+---+---+---+
|   | Q |   |   |   |   |   |   |
+---+---+---+---+---+---+---+---+
|   |   |   |   |   |   | Q |   |
+---+---+---+---+---+---+---+---+
|   |   |   |   | Q |   |   |   |
+---+---+---+---+---+---+---+---+

Found 92 solutions
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Il faut environ 60 ms pour obtenir l'intégralité des solutions et les représenter.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;time &lt;/span&gt;python brute-force.py
python brute-force.py  0,06s user 0,00s system 91% cpu 0,061 total
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Pour cette dimension, c'est tout à fait acceptable et on pourrait s'en contenter. On pourrait... mais ça ne serait pas satisfaisant pour la curiosité !&lt;/p&gt;
&lt;h3&gt;Seconde approche : algorithme de retour sur trace (&lt;em&gt;backtracking&lt;/em&gt;)&lt;/h3&gt;
&lt;p&gt;Cette classe d'algorithmes parcourt toutes les possibilités en éliminant d'emblée toute solution partielle qui ne convient pas. Il permet donc d'éviter de n'avoir ne serait-ce qu'à considérer de nombreuses combinaisons : il est en ce sens plus économe que l'algorithme de force brute. La résolution du problème revient alors à un parcours de graphe.&lt;/p&gt;
&lt;h4&gt;Exemple&lt;/h4&gt;
&lt;p&gt;Pour y voir plus clair, commençons par un exemple simple. On souhaite obtenir les combinaisons de nœuds permettant de former le mot « BLOG » en parcourant l'arbre. On continue de descendre dans l'arbre tant que la combinaison permet d'obtenir une solution (nœuds bleus). Dès que celle-ci ne le permet plus (nœud rouge), on ignore les branches suivantes (nœud gris).&lt;/p&gt;
&lt;p&gt;Dans cet exemple, on n'obtient qu'une solution mais rien n'empêche d'en avoir plusieurs.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Exemple de backtracking" class="center" src="/images/eight_queens/backtracking.png" /&gt;&lt;/p&gt;
&lt;h4&gt;Résolution&lt;/h4&gt;
&lt;p&gt;On conserve la même modélisation : les &lt;em&gt;n&lt;/em&gt; reines sont réparties sur les &lt;em&gt;n&lt;/em&gt; lignes à raison d'une par ligne. On place les reines une par une tant que cela est possible. Si le placement d'une reine échoue — donc qu'il n'existe pas de position telle que la reine puisse être en sécurité, on remet en question les choix précédents afin de sortir du blocage. On revient alors à un point où des alternatives étaient possibles et on essaie la possibilité suivante.&lt;/p&gt;
&lt;p&gt;L'arbre qui sera parcouru contient toutes les positions des reines, valides ou non. On a donc un arbre de la forme de la figure ci-dessous (tronqué, dans l'exemple de 4 reines et d'un échiquier de 16 cases).&lt;/p&gt;
&lt;p&gt;&lt;img alt="Application du backtracking au problème" class="center" src="/images/eight_queens/backtracking_queens.png" /&gt;&lt;/p&gt;
&lt;p&gt;Commençons par nous pencher sur la fonction indiquant si une reine est en sécurité. Nous ne fonctionnons plus avec des permutations contenant toutes les positions des reines mais sur des positions partielles — avec un nombre de reines inférieur au nombre de reines total attendu — valides par rapport auxquelles on vérifie si l'on peut ajouter une reine à une position donnée. Plutôt que de vérifier systématiquement la validité de l'intégralité de la solution, on vérifie que l'ajout d'une reine à la solution partielle précédente donnée produit une solution valide.&lt;/p&gt;
&lt;p&gt;On teste donc :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;que la colonne que laquelle la reine a été placée n'est pas déjà attribuée à une autre reine en vérifiant que le tableau de solutions ne contient pas la colonne que l'on cherche à attribuer (&lt;code&gt;not col in queens&lt;/code&gt;);&lt;/li&gt;
&lt;li&gt;qu'aucune reine ne se trouve sur les mêmes diagonales que la nouvelle.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;is_safe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;col&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;queens&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt;
            &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="nb"&gt;any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;enumerate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Passons à la résolution en elle-même. Pour chaque nouvelle ligne, nous allons tester l'intégralité des colonnes au regard des solutions obtenues jusqu'à la ligne précédente. Cela donne :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;solve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c"&gt;# Initialisation des solutions pour une taille 0 (tableau contenant un tableau vide)&lt;/span&gt;
    &lt;span class="n"&gt;solutions&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;solutions&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;solution&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;solution&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;solutions&lt;/span&gt;
                                    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                                    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;is_safe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;solution&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;solutions&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Pour mieux comprendre cet algorithme, il en existe une &lt;a href="https://www.cs.usfca.edu/~galles/visualization/RecQueens.html"&gt;version animée détaillant les étapes de la résolution&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Troisième approche : programmation par contraintes&lt;/h3&gt;
&lt;h4&gt;Principe&lt;/h4&gt;
&lt;p&gt;Un problème de satisfaction de contraintes (ou CSP pour &lt;em&gt;Constraint Satisfaction Problem&lt;/em&gt;) désigne l'ensemble des problèmes définis par... des contraintes. La résolution consiste à chercher &lt;em&gt;une&lt;/em&gt; solution les respectant. Pour cela, on décrit un modèle définit par :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;un ensemble de variables ;&lt;/li&gt;
&lt;li&gt;un ensemble de contraintes régissant ces variables.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;À partir de ce modèle, le système cherchera une solution et la proposera si elle existe. En revanche, il ne proposera qu'une seule solution : la résolution d'un problème par contraintes n'a pas vocation à chercher l'ensemble exhaustif des solutions.&lt;/p&gt;
&lt;h4&gt;Implémentation&lt;/h4&gt;
&lt;p&gt;En Python, la bibliothèque &lt;a href="http://numberjack.ucc.ie"&gt;Numberjack&lt;/a&gt; facilite la programmation par contraintes. Les auteurs fournissent d'ailleurs à titre d'exemple une &lt;a href="http://numberjack.ucc.ie/examples/nqueens"&gt;solution pour le problème des &lt;em&gt;n&lt;/em&gt; reines&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Dans le cas générique des &lt;em&gt;n&lt;/em&gt; reines, on définit dans notre ensemble de variables les reines. Chacun d'elles est de type &lt;code&gt;Variable(n)&lt;/code&gt;, soit une variable dans un domaine compris entre 0 et &lt;em&gt;n&lt;/em&gt;. La contrainte &lt;code&gt;AllDiff&lt;/code&gt; impose à toutes les expressions qui lui sont passées d'êtres différentes. On impose donc :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;que toutes les reines soient dans des colonnes différentes (&lt;code&gt;AllDiff( queens )&lt;/code&gt;) ;&lt;/li&gt;
&lt;li&gt;que toutes les reines soient sur des diagonales différentes (combinaison de &lt;code&gt;AllDiff( [queens[i] + i for i in range(n)] )&lt;/code&gt; et &lt;code&gt;AllDiff( [queens[i] - i for i in range(n)] )&lt;/code&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;On suppose donc ici aussi que chaque reine est sur une ligne distincte : la reine 0 sera sur la ligne 0, la reine 1 sur la ligne 1, etc.&lt;/p&gt;
&lt;p&gt;La description du modèle devient :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;Numberjack&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;model_queens&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;queens&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Variable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
    &lt;span class="n"&gt;model&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;AllDiff&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;queens&lt;/span&gt; &lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;AllDiff&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;AllDiff&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;La résolution du problème est alors immédiate :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;solve_queens&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;n&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;model_queens&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;solver&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;solver&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="n"&gt;solver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;solve&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;print_chessboard&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Nodes:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;solver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getNodes&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="s"&gt;&amp;#39; Time:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;solver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getTime&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;print_chessboard&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;separator&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;+---&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;+&amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;queen&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;separator&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;|   &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;queen&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_value&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;| Q |&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;   |&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;queen&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_value&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;separator&lt;/span&gt;

&lt;span class="n"&gt;solve_queens&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;solver&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Mistral&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;n&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt; &lt;span class="p"&gt;}))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;La proposition d'une solution est également très rapide :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;+---+---+---+---+---+---+---+---+
| Q |   |   |   |   |   |   |   |
+---+---+---+---+---+---+---+---+
|   |   |   |   | Q |   |   |   |
+---+---+---+---+---+---+---+---+
|   |   |   |   |   |   |   | Q |
+---+---+---+---+---+---+---+---+
|   |   |   |   |   | Q |   |   |
+---+---+---+---+---+---+---+---+
|   |   | Q |   |   |   |   |   |
+---+---+---+---+---+---+---+---+
|   |   |   |   |   |   | Q |   |
+---+---+---+---+---+---+---+---+
|   | Q |   |   |   |   |   |   |
+---+---+---+---+---+---+---+---+
|   |   |   | Q |   |   |   |   |
+---+---+---+---+---+---+---+---+
Nodes: 24  Time: 0.0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Une mesure plus fine du temps d'exécution indique qu'il a fallu environ 20 millisecondes pour proposer cette solution (qui inclut le temps d'exécution total du programme Python).&lt;/p&gt;
&lt;h3&gt;Comparaison des approches&lt;/h3&gt;
&lt;p&gt;On a vu trois méthodes différentes de résolution du problème. Parmi elles, seules deux fournissent l'intégralité des solutions et donc répondent réellement au problème. La résolution par force brute est probablement la plus lisible mais égalment la moins efficace. La solution par retour arrière est légèrement plus complexe mais sa durée de résolution, bien plus faible, la rend nettement plus avantageuse pour un « grand » échiquier.&lt;/p&gt;
&lt;table class="table"&gt;
  &lt;caption&gt;Comparaison des algorithmes pour une résolution avec 8 reines sur un échiquier de 64 cases&lt;/caption&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Algorithme&lt;/th&gt;
      &lt;th&gt;Durée d'exécution&lt;/th&gt;
      &lt;th&gt;Nombre de solutions&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Force brute&lt;/td&gt;
      &lt;td&gt;83 ms&lt;/td&gt;
      &lt;td&gt;92&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Retour sur trace&lt;/td&gt;
      &lt;td&gt;55 ms&lt;/td&gt;
      &lt;td&gt;92&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Programmation par contraintes&lt;/td&gt;
      &lt;td&gt;18 ms&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Comme le montre le tableau ci-dessus, le choix de la méthode de résolution dépendra surtout du besoin : faut-il &lt;em&gt;une&lt;/em&gt; solution ou &lt;em&gt;toutes&lt;/em&gt; les solutions ? Lorsqu'il les faut toutes, les quelques dizaines de millisecondes d'écart entre les deux algorithmes ne font pas la différence pour huit reines. En revanche, l'augmentation de la taille de l'échiquier induit une augmentation exponentielle du temps de résolution. Le graphique ci-dessous montre la flagrance de différence de temps d'exécution entre les deux algorithmes lorsque le nombre de permutations augmente.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Comparaison des durées d'obtention de toutes les solutions en fonction de l'algorithme" class="center" src="/images/eight_queens/comparaison.png" /&gt;&lt;/p&gt;
&lt;p&gt;Dès 10 reines et un échiquier de 100 cases, l'algorithme de force brute n'est plus utilisable : il lui faut plusieurs dizaines de minutes pour fournir les solutions. La solution implémentant l'algorithme de &lt;em&gt;backtracking&lt;/em&gt;, elle, retourne les 14&amp;nbsp;200 solutions en moins de 10 secondes.&lt;/p&gt;
&lt;p&gt;La résolution par contraintes, reste très performante lorsque le problème de complexifie : elle permet d'obtenir une solution en moins de 150&amp;nbsp;ms pour 200 reines et un échiquier de 40&amp;nbsp;000 cases. Bien qu'elle ne propose qu'une et une seule solution, elle peut s'avérer pertinente lorsqu'on ne cherche pas un résultat particulier. L'implémentation présentée ici monte ses limites en dépassant les 500 reines et les 250 000 cases.&lt;/p&gt;</summary><category term="algorithmique"></category><category term="python"></category><category term="jeu"></category></entry><entry><title>Utiliser un Raspberry Pi comme point d'accès Wifi</title><link href="http://www.dericbourg.net/2015/07/04/utiliser-un-raspberry-pi-comme-point-dacces-wifi/" rel="alternate"></link><updated>2015-07-04T00:00:00+02:00</updated><author><name>Alban Dericbourg</name></author><id>tag:www.dericbourg.net,2015-07-04:2015/07/04/utiliser-un-raspberry-pi-comme-point-dacces-wifi/</id><summary type="html">&lt;p&gt;Dans cet article, nous verrons comment configurer un Raspberry Pi en tant que
point d'accès Wifi.&lt;/p&gt;
&lt;h3&gt;Pré-requis&lt;/h3&gt;
&lt;p&gt;Je supposerai que vous avez à disposition :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.raspberrypi.org/"&gt;Un Raspberry Pi&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;La distribution &lt;a href="https://www.raspbian.org/"&gt;Raspbian&lt;/a&gt; ou toute autre
   distribution Linux&lt;/li&gt;
&lt;li&gt;Un &lt;em&gt;dongle&lt;/em&gt; Wifi (déjà installé et détecté)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Dans la suite, on considèrera que l'interface sans fil est nommée &lt;code&gt;wlan0&lt;/code&gt;.  &lt;/p&gt;
&lt;h3&gt;Définition d'une adresse IP statique&lt;/h3&gt;
&lt;p&gt;Dans le fichier &lt;code&gt;/etc/network/interfaces&lt;/code&gt;, supprimer les lignes suivantes :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;iface wlan0 inet manual
wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Les remplacer par :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;allow-hotplug wlan0
iface wlan0 inet static
address 192.168.100.1
netmask 255.255.255.0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Redémarrez le réseau :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo service networking restart
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Installation d'un serveur DHCP&lt;/h3&gt;
&lt;p&gt;Le serveur DHCP permet d'attribuer automatiquement une adresse IP aux machines
qui se connecteront à votre réseau Wifi.&lt;/p&gt;
&lt;p&gt;Installez le paquet &lt;em&gt;&lt;a href="https://packages.debian.org/isc-dhcp-server"&gt;isc-dhcp-server&lt;/a&gt;&lt;/em&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install isc-dhcp-server
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;À ce stade, le service ne devrait pas démarrer correctement :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;Generating /etc/default/isc-dhcp-server...
[FAIL] Starting ISC DHCP server: dhcpd[....] check syslog for diagnostics. ... failed!
 failed!
invoke-rc.d: initscript isc-dhcp-server, action &amp;quot;start&amp;quot; failed.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Vous pouvez ignorer ces erreurs pour le moment.&lt;/p&gt;
&lt;p&gt;Éditez le fichier de configuration du serveur : &lt;code&gt;/etc/dhcp/dhcpd.conf&lt;/code&gt; et
commentez les options &lt;em&gt;domain-name&lt;/em&gt; et &lt;em&gt;domain-name-servers&lt;/em&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;#option domain-name &amp;quot;example.org&amp;quot;;
#option domain-name-servers ns1.example.org, ns2.example.org;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Décommentez la ligne &lt;em&gt;authoritative&lt;/em&gt;. Cela permet d'indiquer à votre serveur
DHCP qu'il est le seul à fournir des adresses IP sur ce réseau et donc possède
la pleine connaissance des
&lt;a href="http://www.linux-france.org/prj/edu/archinet/systeme/ch27s03.html"&gt;baux accordés&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;# If this DHCP server is the official DHCP server for the local
# network, the authoritative directive should be uncommented.
authoritative;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Enfin, configurez le comportement du serveur DHCP :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;subnet 192.168.100.0 netmask 255.255.255.0 {
  range 192.168.100.10 192.168.100.50;
  option broadcast-address 192.168.100.255;
  option routers 192.168.100.1;
  default-lease-time 600;
  max-lease-time 7200;
  option domain-name &amp;quot;local&amp;quot;;
  option domain-name-servers 80.67.169.12;
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Le paramètre &lt;em&gt;range&lt;/em&gt; limite la place d'adresses IP qui seront alouées. On en
permet ici 51 : c'est probablement beaucoup (trop) s'il s'agit de votre réseau
personnel.&lt;/p&gt;
&lt;p&gt;L'option &lt;em&gt;broadcast-address&lt;/em&gt; spécifie l'adresse IP telle que les paquets qui
seront envoyés sur cette adresse seront interceptés par toutes les machines
présentes sur ce réseau (ayant donc une IP entre 192.166.100.1 et
192.168.100.254 car le masque de sous réseau est 255.255.255.0).&lt;/p&gt;
&lt;p&gt;Quant à elle, l'option &lt;em&gt;routers&lt;/em&gt; indique l'adresse de la passerelle, c'est à
dire la machine par laquelle passent tous les paquets sortants du réseau (en
direction ou en provenance d'Internet par exemple). &lt;/p&gt;
&lt;p&gt;On attribue ici un bail pour une durée de 600 secondes avec le paramètre
&lt;em&gt;default-lease-time&lt;/em&gt;. C'est cette durée qui sera utilisée si le client ne
précise rien. S'il demande un bail en précisant une durée, celle-ci lui sera
accordée si elle ne dépasse pas 7200 secondes, comme défini avec le paramètre
&lt;em&gt;max-lease-time&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Cet exemple utilise le DNS de &lt;a href="https://www.fdn.fr"&gt;FDN&lt;/a&gt; (ligne &lt;em&gt;domain-name-servers&lt;/em&gt;).
Vous pouvez bien évidemment en utiliser d'autres (certains préfèrent
&lt;a href="https://developers.google.com/speed/public-dns/"&gt;ceux de Google&lt;/a&gt;...).&lt;/p&gt;
&lt;p&gt;Déclarez enfin l'interface sans fil comme l'interface par défaut pour répondre
aux requêtes DHCP dans le fichier &lt;code&gt;/etc/default/isc-dhcp-server&lt;/code&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;# On what interfaces should the DHCP server (dhcpd) serve DHCP requests?
#       Separate multiple interfaces with spaces, e.g. &amp;quot;eth0 eth1&amp;quot;.
#INTERFACES=&amp;quot;&amp;quot;
INTERFACES=&amp;quot;wlan0&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Installation de &lt;em&gt;hostapd&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://w1.fi/hostapd/"&gt;Hostapd&lt;/a&gt; est un démon permettant de créer un point
d'accès sans fil. Pour l'installer :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install hostapd
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Créez son fichier de configuration, &lt;code&gt;/etc/hostapd/hostapd.conf&lt;/code&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;interface=wlan0
driver=nl80211
ssid=&amp;lt;YOUR SSID&amp;gt;
hw_mode=g
channel=6
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
wpa=2
wpa_passphrase=&amp;lt;YOUR PASSPHRASE&amp;gt;
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Remplacez dans cet exemple :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;YOUR SSID&amp;gt;&lt;/code&gt; par le nom que vous souhaitez donner à votre réseau ;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;YOUR PASSPHRASE&amp;gt;&lt;/code&gt; par le mot de passer permettant l'accès au réseau.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Déclarez enfin ce fichier afin qu'il soit utilisé par hostapd dans
&lt;code&gt;/etc/default/hostapd&lt;/code&gt; en ajoutant la ligne :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;DAEMON_CONF=&amp;quot;/etc/hostapd/hostapd.conf&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Configuration du routage entre l'interface sans fil et l'interface filaire&lt;/h3&gt;
&lt;p&gt;Activer le routage IP dans le fichier &lt;code&gt;/etc/sysctl.conf&lt;/code&gt; en décommentant la
ligne suivante :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;net.ipv4.ip_forward=1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Pour activer ce routage immédiatement (sans avoir besoin de redémarrer), lancez
la commande :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo sh -c &amp;quot;echo 1 &amp;gt; /proc/sys/net/ipv4/ip_forward&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Vous pouvez enfin configurer le routage en utilisant
&lt;em&gt;&lt;a href="http://ipset.netfilter.org/iptables.man.html"&gt;iptables&lt;/a&gt;&lt;/em&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Persistence des règles &lt;em&gt;iptables&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;Les règles &lt;em&gt;iptables&lt;/em&gt; définies précédemment sont perdues au au redémarrage. Pour
les recharger à chaque lancement de la machine, vous pouvez utiliser le paquet
&lt;em&gt;&lt;a href="https://packages.debian.org/iptables-persistent"&gt;iptables-persistent&lt;/a&gt;&lt;/em&gt;. Pour
l'installer :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install iptables-persistent
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Par défaut, il demandera si vous souhaitez enregistrer les règles actuellement
définies. Choisissez « oui ». Si vous souhaitez les redéfinir ultérieurement,
vous pourrez les enregistrer en invoquant la cible &lt;em&gt;save&lt;/em&gt; et les recharger avec
&lt;em&gt;reload&lt;/em&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo /etc/init.d/iptables-persistent save
sudo /etc/init.d/iptables-persistent reload
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;La voie est libre&lt;/h3&gt;
&lt;p&gt;À ce stade, vous deviez être en mesure de vous connecter au point d'accès de
façon transparente. Étant donnée la richesse des matériels et leurs
spécificités, je ne garantis pas que ce « mode d'emploi » soit universel.
J'espère néanmoins qu'il vous aura aidé en première approche à monter votre
propre point d'accès Wifi.&lt;/p&gt;</summary><category term="wifi"></category><category term="raspberrypi"></category><category term="linux"></category><category term="iptables"></category></entry><entry><title>Utiliser un certificat signé par une autorité inconnue en Java</title><link href="http://www.dericbourg.net/2015/06/22/utiliser-un-certificat-signe-par-une-autorite-inconnue-en-java/" rel="alternate"></link><updated>2015-06-22T00:00:00+02:00</updated><author><name>Alban Dericbourg</name></author><id>tag:www.dericbourg.net,2015-06-22:2015/06/22/utiliser-un-certificat-signe-par-une-autorite-inconnue-en-java/</id><summary type="html">&lt;p&gt;Lorsque vous vous connectez à un serveur en utilisant un certificat TLS (le grand frère de SSL depuis une quinzaine d'années), votre client en vérifie la signature. Celle-ci permet de vérifier que :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;celui-ci provient bien d'un émetteur connu ;&lt;/li&gt;
&lt;li&gt;qu'il n'a pas été modifié depuis son émission.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Le doute&lt;/h3&gt;
&lt;p&gt;Il arrive que le certificat soit signé en utilisant un certificat qui est lui-même signé par un autre certificat, lui-même encore signé par... bref : la signature peut remonter sur plusieurs niveaux hiérarchiques. Dans les faits, cela ne change pas grand chose : la vérification sera tout simplement récursive. Le tout est de rencontrer dans la chaîne, généralement « tout en haut » la signature issue d'un certificat faisant autorité. Ces autorités sont connues à l'avance et vous pouvez les vérifier dans les paramètres de votre natigateur ou, par exemple, dans le répertoire &lt;code&gt;/etc/ssl/certs&lt;/code&gt; si vous êtes sous Linux.&lt;/p&gt;
&lt;p&gt;Il s'agit donc d'une liste fermée qui vous a été fournie par un biais ou un autre mais surtout par en biais en lequel vous avez confiance (ou en lequel on vous a obligé à avoir confiance). Mais rien n'oblige qui que ce soit à utiliser l'une de ces autorités racines : on peut également utiliser un certificat auto-signé. Dans ce cas, rien ne permet de garantir avec certitude l'émetteur : au même titre que vous ferez confiance en l'identité de quelqu'un s'il vous présente sa carte d'identité éditée par l'État, vous aurez probablement des doutes si l'on ne vous présente qu'un papier signé par la-dite personne affirmant sa bonne foi.&lt;/p&gt;
&lt;p&gt;Dans la « vraie vie », ce n'est pas parce qu'un individu n'est pas en mesure de vous présenter un document officiel d'identité qu'il est malhonnête. S'il vous présente son badge d'accès à l'entreprise dans laquelle vous travaillez, vous lui ferez confiance et saurez que c'est l'un de vos collègues. Dans ce cas, c'est votre entreprise qui fait autorité et vous faites confiance à son processus d'attribution des badges. De la même façon, un serveur qui utilise un certificat qui n'est pas signé par une autorité reconnue peut tout à fait venir en paix avec de bonnes intentions.&lt;/p&gt;
&lt;p&gt;Un certificat accepté et reconnu dans un environnement restreint est donc préférable à pas de certificat du tout.&lt;/p&gt;
&lt;h3&gt;L'arrivée des problèmes&lt;/h3&gt;
&lt;p&gt;Mais, généralement, lorsque votre client ne connaît pas l'autorité de certification racine, il refuse par défaut la connexion :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;curl -v https://www.exemple.com
* Rebuilt URL to: https://www.example.com/
* Hostname was NOT found in DNS cache
*   Trying 1.2.3.4...
* Connected to www.example.com &lt;span class="o"&gt;(&lt;/span&gt;1.2.3.4&lt;span class="o"&gt;)&lt;/span&gt; port &lt;span class="m"&gt;443&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="c"&gt;#0)&lt;/span&gt;
* successfully &lt;span class="nb"&gt;set &lt;/span&gt;certificate verify locations:
*   CAfile: none
    CApath: /etc/ssl/certs
* SSLv3, TLS handshake, Client hello &lt;span class="o"&gt;(&lt;/span&gt;1&lt;span class="o"&gt;)&lt;/span&gt;:
* SSLv3, TLS handshake, Server hello &lt;span class="o"&gt;(&lt;/span&gt;2&lt;span class="o"&gt;)&lt;/span&gt;:
* SSLv3, TLS handshake, CERT &lt;span class="o"&gt;(&lt;/span&gt;11&lt;span class="o"&gt;)&lt;/span&gt;:
* SSLv3, TLS alert, Server hello &lt;span class="o"&gt;(&lt;/span&gt;2&lt;span class="o"&gt;)&lt;/span&gt;:
* SSL certificate problem: unable to get &lt;span class="nb"&gt;local &lt;/span&gt;issuer certificate
* Closing connection 0
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Comment se connecter, alors ?&lt;/h3&gt;
&lt;p&gt;Face à cela (ignorons la &lt;a href="https://fr.wikipedia.org/wiki/POODLE"&gt;référence à SSLv3&lt;/a&gt; pour l'instant), deux options sont possibles (la troisième, refiler le bébé à votre collègue, n'étant pas traitée ici) :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ignorer les doutes quant au certificat et risquer de communiquer des informations sensibles à un tiers (c'est la porte ouverte à une &lt;a href="https://fr.wikipedia.org/wiki/Attaque_de_l%27homme_du_milieu"&gt;attaque de l'homme du milieu&lt;/a&gt; puisque vous ne vérifiez plus du tout avec qui vous échangez des données) ;&lt;/li&gt;
&lt;li&gt;indiquer que l'on connaît l'autorité racine ou l'une des autorités intermédiaires.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Je ne peux que vous déconseiller avec toute la vigueur qui m'est donnée la première solution et vous apporter tout mon soutien pour la seconde.&lt;/p&gt;
&lt;p&gt;Pour reprendre l'exemple ci-dessus, l'appel avec &lt;code&gt;curl&lt;/code&gt; est simplement complété avec l'option &lt;code&gt;--cacert&lt;/code&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;curl -v https://www.example.com --cacert cert.pem
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Depuis une application Java&lt;/h3&gt;
&lt;p&gt;Le même mécanisme s'applique lorsque vous vous connectez à un service en utilisant une application Java. Si le certificat n'est pas sûr, vous vous verrez refuser la connexion :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Tout comme avec &lt;code&gt;curl&lt;/code&gt;, il existe une option pour spécifier un certificat faisant autorité. Il faut avant tout le stocker dans un conteneur spéficique à la JVM puis de préciser son emplacement dans la propriété système &lt;code&gt;javax.net.ssl.trustStore&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Pour créer ce conteneur, on utilise l'outil &lt;code&gt;keytool&lt;/code&gt; fourni avec le JDK.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;keytool -importcert -file cert.cer -keystore keystore.jks
Entrez le mot de passe du fichier de clés :  
Ressaisissez le nouveau mot de passe :  
&lt;span class="c"&gt;# Ici s&amp;#39;affichent les détails du certificat que vous importez&lt;/span&gt;
Faire confiance à ce certificat ? &lt;span class="o"&gt;[&lt;/span&gt;non&lt;span class="o"&gt;]&lt;/span&gt; :  oui
Certificat ajouté au fichier de clés
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Reste à le déclarer dans votre application :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;javax.net.ssl.trustStore&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/path/to/keystore.jks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;javax.net.ssl.trustStorePassword&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="o"&gt;******);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;La propriété &lt;code&gt;javax.net.ssl.trustStorePassword&lt;/code&gt; correspond au mot de passe que vous avez saisi à l'import du certificat en utilisant &lt;code&gt;keytool&lt;/code&gt;. Dès lors, vous pouvez vous connecter aux services sécurisés utilisant un certificat propre à votre entreprise.&lt;/p&gt;
&lt;h3&gt;Solution globale&lt;/h3&gt;
&lt;p&gt;Il peut être pénible d'utiliser ce morceau de code dans chacune de vos applications, ou tout au moins fastidieux. Heureusement, il est également possible d'enregistrer un certificat au niveau de la JVM. On le déclare alors une bonne fois pour toutes.&lt;/p&gt;
&lt;p&gt;Si vous avez parcouru le répertoire &lt;code&gt;/etc/ssl/certs&lt;/code&gt; évoqué au début de cet article, vous y aurez peut-être remarqué un répertoire &lt;code&gt;java&lt;/code&gt;. Il s'agit du portefeuille de certificats dédié à la JVM.&lt;/p&gt;
&lt;p&gt;Pour y ajouter un certificat, lancez en tant qu'utilisateur privilégié (&lt;em&gt;root&lt;/em&gt;) :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;keytool -import -alias CertificatDeMonEntreprise &lt;span class="se"&gt;\&lt;/span&gt;
  -keypass changeit &lt;span class="se"&gt;\&lt;/span&gt;
  -keystore &lt;span class="nv"&gt;$JAVA_HOME&lt;/span&gt;/jre/lib/security/cacerts &lt;span class="se"&gt;\&lt;/span&gt;
  -file cert.pem
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Notez le mot de passe par défaut du &lt;em&gt;keystore&lt;/em&gt;: « changeit ». Il s'agit du mot de passe par défaut et je vous encourage, si ce n'est déjà fait, à le changer.&lt;/p&gt;
&lt;p&gt;Cette opération est à réaliser sur votre machine de développement mais également sur l'intégralité des serveurs susceptibles d'exécuter vos applications. C'est là qu'une solution de déploiement automatique devient pertinente.&lt;/p&gt;
&lt;p&gt;Vous êtes maintenant capable de vous connecter depuis une application Java à l'ensemble des services exposés avec le certificat TLS de votre entreprise et ce sans nécessiter d'adaptation du code. &lt;/p&gt;
&lt;h3&gt;Depuis une application Java (bis)&lt;/h3&gt;
&lt;p&gt;Si, par malheur, vous ne pouvez pas déposer de fichier sur la machine exécutant votre application (c'est le cas sur certains hébergement « cloud » que je n'aime pas utiliser), vous pouvez toujours « stocker » votre &lt;em&gt;keystore&lt;/em&gt; dans votre livrable (jar, war...). Mais... vous ne pourrez pas l'utiliser directement : la propriété &lt;code&gt;javax.net.ssl.trustStore&lt;/code&gt; ne permet pas de déclarer de référence à un fichier dans le &lt;em&gt;package&lt;/em&gt;. On peut en revanche l'écrire « à la main » sur le disque. L'exemple qui suit utilise &lt;a href="https://github.com/google/guava"&gt;Guava&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="n"&gt;tempDir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Files&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createTempDir&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
&lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="n"&gt;myStore&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tempDir&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;keystore.jks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InputStream&lt;/span&gt; &lt;span class="n"&gt;storeStream&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MyExample&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getClassLoader&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getResourceAsStream&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;keystore.jks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
     &lt;span class="n"&gt;FileOutputStream&lt;/span&gt; &lt;span class="n"&gt;outputStream&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;FileOutputStream&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;myStore&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;ByteStreams&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;storeStream&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;outputStream&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;javax.net.ssl.trustStore&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;myStore&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getAbsolutePath&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt;
        &lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;javax.net.ssl.trustStorePassword&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*******);&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Cannot set trust store&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Voilà qui devrait vous permettre de communiquer avec le reste du monde.&lt;/p&gt;</summary><category term="ssl"></category><category term="tls"></category><category term="java"></category><category term="certificat"></category><category term="signature"></category><category term="sécurité"></category></entry><entry><title>Qu'est-ce qui me motive en tant que développeur ?</title><link href="http://www.dericbourg.net/2015/02/16/quest-ce-qui-me-motive-en-tant-que-developpeur/" rel="alternate"></link><updated>2015-02-16T00:00:00+01:00</updated><author><name>Alban Dericbourg</name></author><id>tag:www.dericbourg.net,2015-02-16:2015/02/16/quest-ce-qui-me-motive-en-tant-que-developpeur/</id><summary type="html">&lt;p&gt;Je suis développeur. Je travaille pour l'ESN MaBoite et suis en mission depuis plusieurs mois chez MonClient. Il est 9h40, j'arrive chez MonClient en retard, déjà fatigué. Sans avoir fait la fête la veille, j'ai pourtant eu du mal à me lever ce matin, je n'avais pas envie.&lt;/p&gt;
&lt;p&gt;Gérard passe à côté de moi sans même me regarder. Jérôme vient me demander d'implémenter une fonctionnalité en urgence. Je ne comprends pas l'objectif de sa demande et lui demande des précisions : « Ce n'est pas important, me répond-il, c'est pour les gogols du pôle métier qui ne comprennent rien à ce qu'ils font, comme d'habitude ». Lorsque j'envisage de leur demander directement les détails nécessaires, il me coupe : la fonctionnalité ne servira jamais, autant la réaliser comme ils l'imaginent, cela nous fera gagner du temps. S'il est sûr de lui, allons-y.&lt;/p&gt;
&lt;p&gt;Avant de m'y mettre, je constate que les tests unitaires du module que j'ai réalisé la semaine dernière ne passent plus. Gérard étant à l'origine de la modification, je vais le voir. « Oui, j'ai repris des trucs, ça ne me plaisait pas et je voulais que ça marche », m'explique-t-il. Je repars avec l'injonction de remettre les tests d'aplomb en fonction de ce qu'il a écrit.&lt;/p&gt;
&lt;p&gt;La journée passe, il est 18h. Au cours de la journée, je n'ai écrit que quelques lignes de code dont je ne suis pas satisfait. Je vois bien qu'il y a des choses à reprendre, que ça pourrait être plus « propre » mais j'ai du mal à identifier comment mieux faire. Je n'ai de toute façon pas l'énergie de m'y pencher. Qu'est-ce qui rend le travail si laborieux ? Pourquoi ma motivation est-elle si basse ?&lt;/p&gt;
&lt;h3&gt;Besoin de sens&lt;/h3&gt;
&lt;p&gt;Le sens est un composant indispensable de la motivation. Pour quoi (en deux mots) suis-je ici ? Quel est mon objectif ? Quel est l'objectif de ma mission ? Le sens peut être vu suivant trois dimensions :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;le sens-sensation, qui nous ancre dans le réel ;&lt;/li&gt;
&lt;li&gt;le sens-direction, le cap à suivre ;&lt;/li&gt;
&lt;li&gt;le sens-signification qui, sans direction, devient une idéologie – pensez à des choses qui vous ont été imposées mais (du moins au premier contact) jamais justifiées : les tests unitaires, l'injection de dépendances… autant de choses, qui, présentées de façon dogmatique, resteront perçues comme des obligations empiriques.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;On peut lui poser comme conditions deux pré-requis (Jacques Lecomte) : le lien et la loi. L'équilibre des deux va engendrer de la cohérence et donner du sens.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Triangle de la résilience" class="center" src="/images/2015-02-18-Quest_ce_qui_me_motive_en_tant_que_developpeur/triangle_resilience.png" /&gt;&lt;/p&gt;
&lt;p&gt;Le lien est en partie de ma responsabilité : un lien de qualité dépend directement de mon savoir-être. Dans un cadre professionnel, on peut décrire (de façon non exhaustive) mon savoir-être par :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ma connaissance de mes besoins ;&lt;/li&gt;
&lt;li&gt;ma capacité à les communiquer sereinement ;&lt;/li&gt;
&lt;li&gt;ma capacité à entendre et à me remettre en question (honnêteté intellectuelle) ;&lt;/li&gt;
&lt;li&gt;ma capacité à reconnaître humblement mes erreurs ;&lt;/li&gt;
&lt;li&gt;ma capacité à accepter de ne pas être parfait et que l'autre n'est pas non plus parfait ;&lt;/li&gt;
&lt;li&gt;ma conscience du fait que je ne suis pas ce que je fais et que l'autre n'est pas ce qu'il fait.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Le lien de qualité, lui, se reconnaît à :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;la convivialité des échanges ;&lt;/li&gt;
&lt;li&gt;mon sentiment d'appartenance au groupe (à l'équipe, à l'entreprise…) ;&lt;/li&gt;
&lt;li&gt;la reconnaissance de mes pairs ;&lt;/li&gt;
&lt;li&gt;mon sentiment d'être légitime, respecté et à ma place.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Une fois créé, ce lien m'assure un sentiment de sécurité parce que je suis en confiance. Un tel sentiment encourage l'initiative et va m'aider à créer d'autres liens. En proposant du lien à l'autre, je lui permets de se sentir accueilli et pris en compte (cela participe à créer un cercle vertueux).&lt;/p&gt;
&lt;p&gt;Revenons à mon exemple. J'ai fait de mon mieux pour créer du lien avec Gérard – qui est mon interlocuteur privilégié chez MonClient – et pour lui montrer que je le respecte : je l'inclus dans les départs à la machine à café, je lui pose des questions ouvertes pour le faire parler de lui, je lui demande son avis au moment de choix techniques importants. Pourtant, Gérard ne dit toujours pas bonjour le matin, ne me regarde pas et élude ou chasse mes questions liées au projet.&lt;/p&gt;
&lt;p&gt;Même avec toute la bonne volonté du monde, il m'est parfois difficile de créer ou de maintenir ce lien : je ne suis jamais à l'abri d'une remarque blessante (même involontaire) ou de tomber sur un interlocuteur réticent. En cas de difficulté, je sais pourtant  qu'il ne sert à rien de « bouder » en évitant du jour au lendemain le rituel du café matinal par exemple. C'est néanmoins un instinct de survie naturel même si, au fond de moi, ce n'est pas ce que je désire.&lt;/p&gt;
&lt;p&gt;Dans ce contexte, qui remarquera que j'arrive une demi-heure plus tard le matin ? Pourquoi m'ennuyer à me lever tôt et à me dépêcher, moi qui ne suis pas du matin, qui plus est pour travailler sur un projet dont je ne comprends pas l'objectif ? Si Gérard n'est pas disposé à établir un lien ni avec moi ni avec les autres, je ne peux rien faire. Je vais, finalement, me désinvestir progressivement de la vie d'équipe jusqu'au jour où j'arriverai à midi et où personne ne me demandera où j'étais.&lt;/p&gt;
&lt;p&gt;Ma responsabilité là-dedans ? Admettre mes difficultés et demander de l'aide.&lt;/p&gt;
&lt;p&gt;Le sens va aussi être soutenu par la loi (ici synonyme de jalons ou de cadre) : la poursuite d'un objectif mène à se donner des règles de conduite mais surtout à adhérer à un cadre (au sein d'une entreprise, d'une équipe, d'un projet), de s'en sentir acteur et de ne pas le subir. Il est nécessaire de comprendre le cadre pour se l'approprier : comment se prennent les décisions ? Comment suis-je consulté ou informé lors de la reconduction ou non de ma mission ? C'est aussi de cette façon que la confiance et le sentiment de sécurité se construisent.&lt;/p&gt;
&lt;p&gt;Quand la loi devient obsolète ou qu'un désaccord s'installe, quand il faut remettre la loi en question, le lien de qualité permet une plus grande liberté dans l'échange. Quand je suis en réunion avec Gérard, je suis très mal à l'aise pour le contredire ou pour remettre en question les idées que je n'approuve pas.&lt;/p&gt;
&lt;p&gt;Si la loi est cohérente, si le lien est de qualité, l'environnement est serein et constructif.&lt;/p&gt;
&lt;h3&gt;Besoin de paix&lt;/h3&gt;
&lt;p&gt;MaBoite est à l'origine de la paix durable que je vis au quotidien chez MonClient ainsi que son garde fou : c'est elle qui cadre mon travail par l'intermédiaire du contrat établi avec MonClient ; c'est ce que je me dois de respecter, mais c'est aussi ce qui me protège.&lt;/p&gt;
&lt;p&gt;Le chercheur Markus Weingardt a étudié les conditions nécessaires à l'instauration de la paix durable. Le « vivre ensemble » tel qu'il le décrit définit trois composantes qui permettent d'atteindre cette paix durable :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;la transparence (qui permet la confiance) ;&lt;/li&gt;
&lt;li&gt;la compétence ;&lt;/li&gt;
&lt;li&gt;la proximité (le lien).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="Triangle de la paix durable" class="center" src="/images/2015-02-18-Quest_ce_qui_me_motive_en_tant_que_developpeur/triangle_paix_durable.png" /&gt;&lt;/p&gt;
&lt;p&gt;Tout comme avec mes collègues du quotidien chez MonClient, un lien de qualité avec MaBoite (son image, ses salariés, sa direction) est également nécessaire à l'équilibre. Une ESN « classique » n'est pas un environnement propice à la proximité : les consultants sont « éclatés » chacun chez un client différent ou sur des missions différentes, ce qui peut entraîner un manque de lien. Néanmoins, cet éloignement peut être compensé : coding dojos, soirées d'équipe…&lt;/p&gt;
&lt;p&gt;Une vigilance toute particulière est à apporter aux outils de communication numérique (e-mail, messagerie instantanée, réseau social d'entreprise…). Ceux-ci ne permettent d'échanger que des mots : on « perd » tout le pan non-verbal de la communication (gestuelle, attitude, mimiques…) mais aussi le ton de la voix. Ceux-ci représentant la plupart du temps la proportion la plus importante de la communication, leur absence crée un grand risque de quiproquos ou d'incompréhensions qui peuvent se révéler dévastateurs.&lt;/p&gt;
&lt;p&gt;La transparence apporte honnêteté et clarté dans les échanges : « Plus j'en sais, même quand ça va mal, plus je fais confiance à l'autre ». Là aussi il s'agit du sentiment de sécurité : si on ne me cache rien, c'est que je suis digne de confiance, que je suis considéré comme un collaborateur et pas seulement comme un produit.
À l'inverse, le manque de transparence émousse la confiance. Comment sont attribuées les primes ou les augmentations ? Pourquoi la direction n'apporte-t-elle pas de réponse à certaines questions ? Comment avoir confiance en une direction qui semble nous cacher des choses ?
La réciproque est également applicable : je suis moi-même transparent pour gagner la confiance de ma direction et de mes collègues. Pourquoi « cacher » mon code et attendre une semaine avant de le partager ? Aurais-je du mal à assumer que je ne suis pas parfait ?&lt;/p&gt;
&lt;p&gt;En tant que prestataire, ce sont avant tout mes compétences que mes clients recherchent. Si le client a recours à un consultant, c'est que ce dernier a une compétence que le client n'a pas. Pourtant, Gérard lance à la machine à café : « Tous les prestas qu'on prend sont mauvais mais comme on n'a pas les moyens de payer plus cher pour en avoir des bons, on n'a pas le choix, on prend les mauvais ». Une telle remarque traduit un manque de confiance de sa part envers les prestataires – dont moi – et entame ma propre confiance en moi.&lt;/p&gt;
&lt;p&gt;De façon générale, nos compétences sont interdépendantes :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;elles entretiennent le sentiment d'appartenance entre les développeurs – je serais plus fier de travailler avec des gens dont je reconnais les compétences ;&lt;/li&gt;
&lt;li&gt;les commerciaux compétents trouvent des clients et des missions intéressantes ;&lt;/li&gt;
&lt;li&gt;la compétence des développeurs aide les commerciaux à démarcher les clients ;&lt;/li&gt;
&lt;li&gt;un service RH compétent aide à entretenir la motivation des salariés ;&lt;/li&gt;
&lt;li&gt;des salariés motivés et avec un fort sentiment d'appartenance aident au recrutement en diffusant une bonne image ;&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Mais encore faut-il qu'elles soient reconnues à leur juste place.&lt;/p&gt;
&lt;h3&gt;Besoin d'autonomie et de reconnaissance&lt;/h3&gt;
&lt;p&gt;Pour que ses salariés se sentent reconnus, l'employeur a notamment la responsabilité de leur permettre d'être autonomes. On est autonome lorsque l'on est en mesure de se débrouiller seul sans craindre de perdre son identité lorsque l'on demande de l'aide.&lt;/p&gt;
&lt;p&gt;Vincent Lenhardt structure l'autonomie autour de quatre niveaux décrits par le schéma qui suit.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Structure de l'autonomie en quatre niveaux selon Vincent Lenhardt" class="center" src="/images/2015-02-18-Quest_ce_qui_me_motive_en_tant_que_developpeur/autonomie.png" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;En situation de dépendance, on dit « oui » à tout. On est incapable de prendre une décision et on s'identifie à la relation avec l'autre (un collègue ou MaBoîte).&lt;/li&gt;
&lt;li&gt;Progressivement, on se rebelle, on apprend à dire « non » à l'autre, on l'accuse : on est alors en situation de contre-dépendance.&lt;/li&gt;
&lt;li&gt;À l'étape suivante, on ne demande plus rien à l'autre, on se centre sur soi-même et on n'accepte plus qu'une seule contrainte : celle de MonClient.&lt;/li&gt;
&lt;li&gt;Enfin, on peut atteindre une situation d'équilibre dans laquelle on sait se débrouiller seul ou en groupe. On ne s'identifie pas à la relation : il y a « soi », « l'autre » et « la relation entre l'autre et soi ». On est alors en mesure d'accepter la contrainte et de prendre en charge une autre personne.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;L'autonomie permet d'accéder au sens de son travail.&lt;/p&gt;
&lt;h3&gt;Comme un humain&lt;/h3&gt;
&lt;p&gt;Si les composantes de la paix durable sont solides et équilibrées, le cadre est suffisamment sécurisant pour que, associé aux liens que je trouve en mission chez MonClient aussi bien que dans MaBoite, j'y trouve du sens.&lt;/p&gt;
&lt;p&gt;Si mon employeur prend ses responsabilités pour créer un cadre sécurisant en tant que garant de la loi (cf. triangle de la résilience), associé au lien de qualité, je trouve le sens qui me donne envie de me lever le matin.&lt;/p&gt;
&lt;p&gt;« Ce dont l'humain a besoin, ce n'est pas de vivre sans tension mais bien de tendre vers un but valable, de réaliser une mission librement choisie. Il a besoin non de se libérer de sa tension, mais plutôt de se sentir appelé à accomplir quelque chose » (Viktor E. Frankl, Découvrir un sens à sa vie avec la logothérapie, 1959, édition J'ai lu, p. 129).&lt;/p&gt;
&lt;p&gt;Finalement, j'ai besoin de la même chose que tout être humain, ce n'est pas spécifique au métier de développeur : ce qui me motive en tant que développeur, c'est ce qui me motive tout court.&lt;/p&gt;</summary><category term="quotidien"></category><category term="vivre ensemble"></category><category term="motivation"></category><category term="bien-être"></category></entry><entry><title>Shell shock : un obus dans les dents de bash</title><link href="http://www.dericbourg.net/2014/09/26/shell-shock-un-obus-dans-les-dents-de-bash/" rel="alternate"></link><updated>2014-09-26T00:00:00+02:00</updated><author><name>Alban Dericbourg</name></author><id>tag:www.dericbourg.net,2014-09-26:2014/09/26/shell-shock-un-obus-dans-les-dents-de-bash/</id><summary type="html">&lt;p&gt;Vous avez probablement entendu parler de Shell shock qui, outre l'association de troubles psychiques et physiques observés chez &lt;a href="http://fr.wikipedia.org/wiki/Obusite"&gt;certains soldats de la Première Guerre Mondiale&lt;/a&gt;, désigne également la vulnérabilité &lt;a href="http://www.cert.ssi.gouv.fr/site/CERTFR-2014-ALE-006/index.html"&gt;CVE-2014-6271&lt;/a&gt; touchant GNU bash. Elle permet à un attaquant de provoquer une exécution de code arbitraire à distance.&lt;/p&gt;
&lt;h3&gt;Mon dieu, mais c'est horrible !&lt;/h3&gt;
&lt;p&gt;Il faut avouer que ça ne présage pas d'une franche partie de rigolade.&lt;/p&gt;
&lt;p&gt;Tout d'abord, de nombreux programmes interagissent avec le shell. Nous savons que ce n'est généralement pas une bonne idée mais cela nous simplifie parfois grandement la tâche (on dit souvent qu'un bon développeur est un développeur fainéant). La surface d'attaque est donc très étendue.&lt;/p&gt;
&lt;p&gt;Par ailleurs, si les systèmes « évidents » seront patchés (un serveur web par exemple), certaines machines plus obscures ne le seront pas : pensez par exemple à des périphériques tels que les caméras connectées (ou plus largement tout ce que vous pouvez trouver sur l'Internet des objets). Rien n'exclut qu'elles exposent des services basés sur des scripts shell et si ce shell est bash, le périphérique devient vulnérable. Comme il y a fort à parier qu'aucune procédure de mise à jour de ces périphériques n'ait été définie, ces périphérques resteront vulnérables ad vitam aeternam.&lt;/p&gt;
&lt;h3&gt;J'exige des explications&lt;/h3&gt;
&lt;p&gt;Bash permet d'exporter des variables mais aussi des fonctions à destination d'autres instances de bash. L'export de fonction utilise une variable d'environnement portant le nom de la-dite fonction dont la valeur commence par &lt;code&gt;() {&lt;/code&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;foo&lt;/span&gt;&lt;span class="o"&gt;=()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    du code
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;À l'import, il se contente aveuglément d'interpréter cela en remplaçant le signe « = » par une espace. C'est ainsi que bash ne se limite pas à interpréter le corps de la fonction mais qu'il poursuit le parsing et exécute les commandes qui suivent la définition de la fonction. Par exemple, définir une variable d'environnement de cette sorte :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;FOO&lt;/span&gt;&lt;span class="o"&gt;=()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; ignored&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; /bin/yolo
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;exécutera &lt;code&gt;/bin/yolo&lt;/code&gt; quand l'environnement sera importé par bash.&lt;/p&gt;
&lt;p&gt;Ainsi, tout système utilisant bash est vulnérable, mais il est particulièrement vulnérable :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;s'il expose un service sur le réseau (a fortiori sur Internet) ;&lt;/li&gt;
&lt;li&gt;que ce service exploite des paramètres passés par le client et qu'il les stocke dans une variable d'environnement ;&lt;/li&gt;
&lt;li&gt;et que ce service lance bash pour un traitement quelconque.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour savoir si votre machine est vulnérable, vous pouvez lancer :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;env &lt;span class="nv"&gt;VAR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;() { 0; }; echo danger&amp;#39;&lt;/span&gt; bash -c &lt;span class="s2"&gt;&amp;quot;echo bonjour&amp;quot;&lt;/span&gt;

Si tout va bien, vous devriez observer ceci :

&lt;span class="sb"&gt;```&lt;/span&gt;bash
&lt;span class="nv"&gt;$ &lt;/span&gt;env &lt;span class="nv"&gt;VAR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;() { 0; }; echo danger&amp;#39;&lt;/span&gt; bash -c &lt;span class="s2"&gt;&amp;quot;echo bonjour&amp;quot;&lt;/span&gt;
bash: warning: VAR: ignoring &lt;span class="k"&gt;function&lt;/span&gt; definition attempt
bash: error importing &lt;span class="k"&gt;function&lt;/span&gt; definition &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;VAR&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;
bonjour
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Si tout ne va pas bien, vous observerez :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;env &lt;span class="nv"&gt;VAR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;() { 0; }; echo danger&amp;#39;&lt;/span&gt; bash -c &lt;span class="s2"&gt;&amp;quot;echo bonjour&amp;quot;&lt;/span&gt;
danger
bonjour
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;À noter que Linux n'est pas le seul système touché. Tous les systèmes Unix (ce qui inclut Mac OS) sont concernés.&lt;/p&gt;
&lt;h3&gt;M'enfin, qui serait assez bête pour exposer un machin bash sur Internet ?&lt;/h3&gt;
&lt;p&gt;Moi – et probablement vous aussi – mais je ne pense pas que ce soit de la bêtise.&lt;/p&gt;
&lt;p&gt;Pour l'instant, le vecteur de propagation semble être la requête HTTP à destination d'un script CGI. Le serveur web &lt;em&gt;Apache httpd&lt;/em&gt; utilise par exemple des scripts (donc potentiellement bash) pour certaines fonctions C, Python ou PHP (si ce dernier est lancé en mode CGI). C'est ainsi que quelques robots parcourent en ce moment même le web en positionnant leur en-tête &lt;em&gt;User-Agent&lt;/em&gt; comme suit afin de dresser leur annuaire des machines vulnérables : &lt;code&gt;User-Agent: () { :; } /bin/ping -c x.y.z.q&lt;/code&gt;. Si vous souhaitez vérifier vos logs HTTP, vous pouvez lancer &lt;code&gt;egrep '\(\ *\)\ *\{' /var/log/nginx/*&lt;/code&gt; par exemple.&lt;/p&gt;
&lt;p&gt;Ce n'est donc pas si rare et c'est sans compter les applications largement déployées qui utilisent CGI (cPanel par exemple).&lt;/p&gt;
&lt;p&gt;Enfin – et plus localement, certains clients DHCP utilisent également des scripts pour configurer le système. Si le serveur est corrompu (ou mal intentionné), cela permet d'exécuter des commandes – vraisemblablement en &lt;em&gt;root&lt;/em&gt; – sur la machine cliente.
Il ne peut plus rien nous arriver d'affreux maintenant&lt;/p&gt;
&lt;p&gt;Une fois le patch passé, vous devriez déjà être plus sereins. Néanmoins, &lt;a href="https://securityblog.redhat.com/2014/09/24/bash-specially-crafted-environment-variables-code-injection-attack/"&gt;comme l'indique RedHat&lt;/a&gt;, le patch fourni laisse quelques trous dans la raquette. Il est notamment possible, sous certaines conditions, d'exécuter du code contenu dans des variables d'environnement (CVE-2014-7169). Reste à attendre le patch du patch.&lt;/p&gt;
&lt;p&gt;Pour tester votre vulnérabilité à &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7169"&gt;CVE-2014-7169&lt;/a&gt;, vous pouvez lancer :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;env &lt;span class="nv"&gt;X&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;() { (a)=&amp;gt;\&amp;#39;&lt;/span&gt; sh -c &lt;span class="s2"&gt;&amp;quot;echo date&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; cat &lt;span class="nb"&gt;echo&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Si vous obtenez la date, votre système est vulnérable.&lt;/p&gt;
&lt;p&gt;À suivre, donc.&lt;/p&gt;</summary><category term="bash"></category><category term="sécurité"></category><category term="cve"></category></entry></feed>