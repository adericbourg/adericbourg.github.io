<!DOCTYPE html>
<html lang="fr">
<head>

        <title>Shell shock : un obus dans les dents de bash - Blog bloquant</title>
        <meta charset="utf-8" />
        <link href="http://www.dericbourg.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Blog bloquant Full Atom Feed" />
        <link href="http://www.dericbourg.net/feeds/blog.atom.xml" type="application/atom+xml" rel="alternate" title="Blog bloquant Categories Atom Feed" />

        <!-- Twitter card -->
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@adericbourg" />
        <meta name="twitter:title" content="Shell shock : un obus dans les dents de bash - Blog bloquant" />
        <meta name="twitter:description" content="Vous avez probablement entendu parler de Shell shock qui, outre l'association de troubles psychiques et physiques observés chez certains soldats de la Première Guerre Mondiale, désigne également la vulnérabilité CVE-2014-6271 touchant GNU bash. Elle permet à un attaquant de provoquer une exécution de code arbitraire à distance. Mon dieu ..." />
        
        <!-- Facebook Open Graph Meta Tags -->
        <meta property="og:site_name" content="Blog bloquant"/>
        <meta property="og:title" content="Shell shock : un obus dans les dents de bash"/>
        <meta property="og:url" content="http://www.dericbourg.net/2014/09/26/shell-shock-un-obus-dans-les-dents-de-bash/index.html"/>
        <meta property="og:description" content="Vous avez probablement entendu parler de Shell shock qui, outre l'association de troubles psychiques et physiques observés chez certains soldats de la Première Guerre Mondiale, désigne également la vulnérabilité CVE-2014-6271 touchant GNU bash. Elle permet à un attaquant de provoquer une exécution de code arbitraire à distance. Mon dieu ..."/>
        <meta property="og:type" content="blog"/>

        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="http://www.dericbourg.net/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="http://www.dericbourg.net/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="http://www.dericbourg.net/theme/pygment.css" />

        <script src="http://www.dericbourg.net/theme/js/libs/modernizr-2.6.2.min.js"></script>




</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="http://www.dericbourg.net/">Blog bloquant <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>

              <ul class="columns">
                <li><a href="http://www.dericbourg.net/">Accueil</a></li>

              </ul>


            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">Shell shock : un obus dans les dents de bash</h2>
           
              <div>
                    <a class="info label" href="http://www.dericbourg.net/tag/bash.html">bash</a>
                    <a class="info label" href="http://www.dericbourg.net/tag/securite.html">sécurité</a>
                    <a class="info label" href="http://www.dericbourg.net/tag/cve.html">cve</a>
              </div>
            </header>
            <footer class="post-info">

              <abbr class="published" title="2014-09-26T00:00:00+02:00">
                ven. 26 septembre 2014
              </abbr>
              &ndash;
              <a href="http://www.dericbourg.net/2014/09/26/shell-shock-un-obus-dans-les-dents-de-bash/" rel="bookmark" title="Lien permanent vers Shell shock : un obus dans les dents de bash">lien permanent</a>
              <address class="vcard author">Par
                <a class="url fn" href="http://www.dericbourg.net/author/alban-dericbourg.html"> Alban Dericbourg</a>
              </address>

            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>Vous avez probablement entendu parler de Shell shock qui, outre l'association de troubles psychiques et physiques observés chez <a href="http://fr.wikipedia.org/wiki/Obusite">certains soldats de la Première Guerre Mondiale</a>, désigne également la vulnérabilité <a href="http://www.cert.ssi.gouv.fr/site/CERTFR-2014-ALE-006/index.html">CVE-2014-6271</a> touchant GNU bash. Elle permet à un attaquant de provoquer une exécution de code arbitraire à distance.</p>
<h3>Mon dieu, mais c'est horrible !</h3>
<p>Il faut avouer que ça ne présage pas d'une franche partie de rigolade.</p>
<p>Tout d'abord, de nombreux programmes interagissent avec le shell. Nous savons que ce n'est généralement pas une bonne idée mais cela nous simplifie parfois grandement la tâche (on dit souvent qu'un bon développeur est un développeur fainéant). La surface d'attaque est donc très étendue.</p>
<p>Par ailleurs, si les systèmes « évidents » seront patchés (un serveur web par exemple), certaines machines plus obscures ne le seront pas : pensez par exemple à des périphériques tels que les caméras connectées (ou plus largement tout ce que vous pouvez trouver sur l'Internet des objets). Rien n'exclut qu'elles exposent des services basés sur des scripts shell et si ce shell est bash, le périphérique devient vulnérable. Comme il y a fort à parier qu'aucune procédure de mise à jour de ces périphériques n'ait été définie, ces périphérques resteront vulnérables ad vitam aeternam.</p>
<h3>J'exige des explications</h3>
<p>Bash permet d'exporter des variables mais aussi des fonctions à destination d'autres instances de bash. L'export de fonction utilise une variable d'environnement portant le nom de la-dite fonction dont la valeur commence par <code>() {</code> :</p>
<div class="highlight"><pre><span class="nv">foo</span><span class="o">=()</span> <span class="o">{</span>
    du code
<span class="o">}</span>
</pre></div>


<p>À l'import, il se contente aveuglément d'interpréter cela en remplaçant le signe « = » par une espace. C'est ainsi que bash ne se limite pas à interpréter le corps de la fonction mais qu'il poursuit le parsing et exécute les commandes qui suivent la définition de la fonction. Par exemple, définir une variable d'environnement de cette sorte :</p>
<div class="highlight"><pre><span class="nv">FOO</span><span class="o">=()</span> <span class="o">{</span> ignored<span class="p">;</span> <span class="o">}</span><span class="p">;</span> /bin/yolo
</pre></div>


<p>exécutera <code>/bin/yolo</code> quand l'environnement sera importé par bash.</p>
<p>Ainsi, tout système utilisant bash est vulnérable, mais il est particulièrement vulnérable :</p>
<ul>
<li>s'il expose un service sur le réseau (a fortiori sur Internet) ;</li>
<li>que ce service exploite des paramètres passés par le client et qu'il les stocke dans une variable d'environnement ;</li>
<li>et que ce service lance bash pour un traitement quelconque.</li>
</ul>
<p>Pour savoir si votre machine est vulnérable, vous pouvez lancer :</p>
<div class="highlight"><pre><span class="nv">$ </span>env <span class="nv">VAR</span><span class="o">=</span><span class="s1">&#39;() { 0; }; echo danger&#39;</span> bash -c <span class="s2">&quot;echo bonjour&quot;</span>

Si tout va bien, vous devriez observer ceci :

<span class="sb">```</span>bash
<span class="nv">$ </span>env <span class="nv">VAR</span><span class="o">=</span><span class="s1">&#39;() { 0; }; echo danger&#39;</span> bash -c <span class="s2">&quot;echo bonjour&quot;</span>
bash: warning: VAR: ignoring <span class="k">function</span> definition attempt
bash: error importing <span class="k">function</span> definition <span class="k">for</span> <span class="sb">`</span>VAR<span class="err">&#39;</span>
bonjour
</pre></div>


<p>Si tout ne va pas bien, vous observerez :</p>
<div class="highlight"><pre><span class="nv">$ </span>env <span class="nv">VAR</span><span class="o">=</span><span class="s1">&#39;() { 0; }; echo danger&#39;</span> bash -c <span class="s2">&quot;echo bonjour&quot;</span>
danger
bonjour
</pre></div>


<p>À noter que Linux n'est pas le seul système touché. Tous les systèmes Unix (ce qui inclut Mac OS) sont concernés.</p>
<h3>M'enfin, qui serait assez bête pour exposer un machin bash sur Internet ?</h3>
<p>Moi – et probablement vous aussi – mais je ne pense pas que ce soit de la bêtise.</p>
<p>Pour l'instant, le vecteur de propagation semble être la requête HTTP à destination d'un script CGI. Le serveur web <em>Apache httpd</em> utilise par exemple des scripts (donc potentiellement bash) pour certaines fonctions C, Python ou PHP (si ce dernier est lancé en mode CGI). C'est ainsi que quelques robots parcourent en ce moment même le web en positionnant leur en-tête <em>User-Agent</em> comme suit afin de dresser leur annuaire des machines vulnérables : <code>User-Agent: () { :; } /bin/ping -c x.y.z.q</code>. Si vous souhaitez vérifier vos logs HTTP, vous pouvez lancer <code>egrep '\(\ *\)\ *\{' /var/log/nginx/*</code> par exemple.</p>
<p>Ce n'est donc pas si rare et c'est sans compter les applications largement déployées qui utilisent CGI (cPanel par exemple).</p>
<p>Enfin – et plus localement, certains clients DHCP utilisent également des scripts pour configurer le système. Si le serveur est corrompu (ou mal intentionné), cela permet d'exécuter des commandes – vraisemblablement en <em>root</em> – sur la machine cliente.
Il ne peut plus rien nous arriver d'affreux maintenant</p>
<p>Une fois le patch passé, vous devriez déjà être plus sereins. Néanmoins, <a href="https://securityblog.redhat.com/2014/09/24/bash-specially-crafted-environment-variables-code-injection-attack/">comme l'indique RedHat</a>, le patch fourni laisse quelques trous dans la raquette. Il est notamment possible, sous certaines conditions, d'exécuter du code contenu dans des variables d'environnement (CVE-2014-7169). Reste à attendre le patch du patch.</p>
<p>Pour tester votre vulnérabilité à <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7169">CVE-2014-7169</a>, vous pouvez lancer :</p>
<div class="highlight"><pre><span class="nv">$ </span>env <span class="nv">X</span><span class="o">=</span><span class="s1">&#39;() { (a)=&gt;\&#39;</span> sh -c <span class="s2">&quot;echo date&quot;</span><span class="p">;</span> cat <span class="nb">echo</span>
</pre></div>


<p>Si vous obtenez la date, votre système est vulnérable.</p>
<p>À suivre, donc.</p>
            </div><!-- /.entry-content -->
            <div class="comments">
              <h3>Comments</h3>
              <div id="disqus_thread"></div>
              <script type="text/javascript">
                  var disqus_shortname = 'dericbourg';
                  (function() {
                      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
              </script>
              <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>


        </div><!-- /.eleven.columns -->

<div class="three columns">

      <div class="btn primary"><a href="https://github.com/adericbourg" target="_blank">Github</a></div>

      <div class="btn twitter"><a href="https://twitter.com/adericbourg" target="_blank">Twitter</a></div>



<!--
<h4>Pages</h4>

 <ul>
  </ul>

<h4>Catégories</h4>
<ul>
		<li><a href="http://www.dericbourg.net/category/blog.html">Blog</a></li>
</ul>

-->
<h4>Tags</h4>
	<ul id="sidebar-tags">
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/certificat.html">certificat</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/ssl.html">ssl</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/bash.html">bash</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/tls.html">tls</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/raspberrypi.html">raspberrypi</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/wifi.html">wifi</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/cve.html">cve</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/bien-etre.html">bien-être</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/iptables.html">iptables</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/java.html">java</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/vivre-ensemble.html">vivre ensemble</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/quotidien.html">quotidien</a></li>
	    <li class="tag tag-1"><a href="http://www.dericbourg.net/tag/securite.html">sécurité</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/motivation.html">motivation</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/linux.html">linux</a></li>
	    <li class="tag tag-4"><a href="http://www.dericbourg.net/tag/signature.html">signature</a></li>
</ul>



</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">


        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>
        </footer>

    </div>


<script type="text/javascript">
    var disqus_shortname = 'dericbourg';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
  <script src="http://www.dericbourg.net/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="http://www.dericbourg.net/theme/js/libs/gumby.min.js"></script>
  <script src="http://www.dericbourg.net/theme/js/plugins.js"></script>
</body>
</html>